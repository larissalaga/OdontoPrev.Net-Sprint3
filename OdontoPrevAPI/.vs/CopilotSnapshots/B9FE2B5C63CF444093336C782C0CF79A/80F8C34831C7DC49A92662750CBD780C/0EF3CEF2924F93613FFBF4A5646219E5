using Microsoft.AspNetCore.Mvc;
using OdontoPrevAPI.Repositories.Interfaces;
using System.Threading.Tasks;

namespace OdontoPrevAPI.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class PacienteController : ControllerBase
    {
        private readonly IPacienteRepository _pacienteRepository;

        public PacienteController(IPacienteRepository pacienteRepository)
        {
            _pacienteRepository = pacienteRepository;
        }

        [HttpGet("all")]
        public async Task<IActionResult> GetAllPacientes()
        {
            var pacientes = await _pacienteRepository.GetAll();
            return Ok(pacientes);
        }

        [HttpGet("cpf/{nrCpf}")]
        public async Task<IActionResult> GetPacienteByCpf(string nrCpf)
        {
            // Remove special characters from CPF
            var sanitizedCpf = System.Text.RegularExpressions.Regex.Replace(nrCpf, "[^0-9]", "");
            var paciente = await _pacienteRepository.GetByNrCpf(sanitizedCpf);
            return Ok(paciente);
        }

        [HttpGet("id/{id}")]
        public async Task<IActionResult> GetPacienteById(int id)
        {
            var paciente = await _pacienteRepository.GetById(id);
            return Ok(paciente);
        }
    }
}
